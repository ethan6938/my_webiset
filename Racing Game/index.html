<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>My Phaser Racing Game</title>
  <script src="https://cdn.jsdelivr.net/npm/phaser@3.55.2/dist/phaser.min.js"></script>
  <style>
    body {
      margin: 0;
      background: #0c5e03;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
    }
    #phaser-example {
      border: 4px solid #fff;
      box-shadow: 0 0 20px #0c5e03;
    }
  </style>
</head>
<body>
  <div id="phaser-example"></div>

  <script>
    class MyGame extends Phaser.Scene {
      preload() {
        this.load.setBaseURL('https://cdn.phaserfiles.com/v385');
        this.load.image('track', 'assets/particles/racetrack-bend.png');
        this.load.image('car', 'assets/sprites/car-red.png');
      }

      create() {
        this.add.image(450, 300, 'track').setScale(0.8);

        // Add car sprite and enable physics on it
        this.car = this.physics.add.sprite(450, 500, 'car').setScale(0.5);
        this.car.setOrigin(0.5, 0.5);

        // Keyboard input
        this.cursors = this.input.keyboard.createCursorKeys();

        // Movement params
        this.carSpeed = 0;
        this.maxSpeed = 200;
        this.acceleration = 300;
        this.drag = 150;
        this.turnSpeed = 150;
      }

      update(time, delta) {
        const dt = delta / 1000;

        // Accelerate or decelerate
        if (this.cursors.up.isDown) {
          this.carSpeed += this.acceleration * dt;
        } else if (this.cursors.down.isDown) {
          this.carSpeed -= this.acceleration * dt;
        } else {
          // Slow down naturally
          if (this.carSpeed > 0) {
            this.carSpeed -= this.drag * dt;
            if (this.carSpeed < 0) this.carSpeed = 0;
          } else if (this.carSpeed < 0) {
            this.carSpeed += this.drag * dt;
            if (this.carSpeed > 0) this.carSpeed = 0;
          }
        }

        // Clamp speed
        this.carSpeed = Phaser.Math.Clamp(this.carSpeed, -this.maxSpeed / 2, this.maxSpeed);

        // Rotate car left/right only if moving
        if (this.carSpeed !== 0) {
          if (this.cursors.left.isDown) {
            this.car.angle -= this.turnSpeed * dt * (this.carSpeed > 0 ? 1 : -1);
          }
          if (this.cursors.right.isDown) {
            this.car.angle += this.turnSpeed * dt * (this.carSpeed > 0 ? 1 : -1);
          }
        }

        // Move car forward based on angle
        this.physics.velocityFromAngle(this.car.angle - 90, this.carSpeed, this.car.body.velocity);

        // Keep car inside the canvas
        this.car.x = Phaser.Math.Clamp(this.car.x, 50, 800 - 50);
        this.car.y = Phaser.Math.Clamp(this.car.y, 50, 600 - 50);
      }
    }

    const config = {
      type: Phaser.AUTO,
      width: 800,
      height: 600,
      backgroundColor: '#0c5e03',
      parent: 'phaser-example',
      physics: { default: 'arcade' },
      scene: MyGame,
    };

    const game = new Phaser.Game(config);
  </script>
</body>
</html>
