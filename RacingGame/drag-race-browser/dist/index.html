<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Drag Race </title>
  <style>
    body { margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto; background:#111; color:#fff; }
    .menu { position:fixed; inset:0; display:flex; flex-direction:column; align-items:center; justify-content:center; gap:40px; z-index:2; background:#111;}
    .choices { display:flex; gap:15px; margin-top:10px;}
    .choices img { width:100px; border:3px solid transparent; border-radius:10px; cursor:pointer; transition:transform .2s, border-color .2s; }
    .choices img:hover { transform:scale(1.05); }
    .choices img.selected { border-color:#fff; }
    .btn { padding:12px 28px; font-size:20px; background:#444; color:#fff; border:none; border-radius:8px; cursor:pointer; }
    #phaser-root { display:none; }
    #hud { position:fixed; top:20px; left:20px; z-index:3; display:none; flex-direction:column; gap:12px; }
    .hud-btn { font-family:monospace; font-size:16px; color:#fff; background:rgba(0,0,0,.4); padding:8px 12px; border:2px solid #fff; border-radius:8px; cursor:pointer; }
    #speedometer { font-family:monospace; font-size:20px; color:#fff; background:rgba(0,0,0,.4); padding:8px 12px; border-radius:8px; }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/phaser@3.55.2/dist/phaser.min.js"></script>
</head>
<body>
  <div id="menu" class="menu">
    <div class="section">
      <h2>Select Track</h2>
      <div class="choices" id="track-choices">
        <img src="../public/images/track.png" data-value="track" alt="Easy">
        <img src="../public/images/track2.png" data-value="track2" alt="Medium">
        <img src="../public/images/track3.png" data-value="track3" alt="Hard">
      </div>
    </div>
    <div class="section">
      <h2>Select Car</h2>
      <div class="choices" id="car-choices">
        <img src="../public/images/car.png" data-value="car" alt="Car 1">
        <img src="../public/images/car2.png" data-value="car2" alt="Car 2">
      </div>
    </div>
    <button id="start-btn" class="btn">Start Race</button>
  </div>

  <div id="phaser-root"></div>

  <div id="hud">
    <div id="speedometer">Speed: 0 km/h</div>
    <button class="hud-btn" id="game-start-btn">Start</button>
    <button class="hud-btn" id="restart-btn">Restart</button>
    <button class="hud-btn" id="back-btn">Back</button>
  </div>

  <script>
    // --- Simple browser-only version mirroring the React app behavior ---
    let selectedTrack = 'track';
    let selectedCar = 'car';
    let phaserGame;
    let gameStartedFlag = false;
    let sceneRef = null;

    function getFinishDistance() {
      if (selectedTrack === 'track') return 1000;
      if (selectedTrack === 'track2') return 1800;
      if (selectedTrack === 'track3') return 2600;
      return 1400;
    }

    class DragRace extends Phaser.Scene {
      constructor() { super('DragRace'); this.finished=false; }
      preload() {
        this.load.image('track', `../public/images/${selectedTrack}.png`);
        this.load.image('car', `../public/images/${selectedCar}.png`);
        const opp = selectedCar === 'car' ? 'car2' : 'car';
        this.load.image('car2', `../public/images/${opp}.png`);
      }
      create() {
        const finishDistance = getFinishDistance();
        this.physics.world.setBounds(0,0,this.scale.width,finishDistance);
        this.add.tileSprite(0,0,this.scale.width,finishDistance,'track').setOrigin(0,0).setScrollFactor(1);

        this.car = this.physics.add.sprite(this.scale.width/2-100, finishDistance-100, 'car').setScale(0.25).setCollideWorldBounds(true);
        this.opponent = this.physics.add.sprite(this.scale.width/2+100, finishDistance-100, 'car2').setScale(0.25).setCollideWorldBounds(true);

        this.cameras.main.startFollow(this.car);
        this.cameras.main.setBounds(0,0,this.scale.width,finishDistance);

        this.keys = this.input.keyboard.addKeys('W');

        this.finishLine = this.add.zone(this.scale.width/2, 100, this.scale.width, 20);
        this.physics.world.enable(this.finishLine);
        this.finishLine.body.setAllowGravity(false);
        this.finishLine.body.moves = false;

        this.physics.add.overlap(this.car, this.finishLine, this.playerWins, null, this);
        this.physics.add.overlap(this.opponent, this.finishLine, this.opponentWins, null, this);

        sceneRef = this;
      }
      update() {
        if (this.finished || !gameStartedFlag) return;
        const maxSpeed = 700/3.6;
        const acc = 200;
        if (this.keys.W.isDown) {
          if (this.car.body.velocity.y > -maxSpeed) this.car.setAccelerationY(-acc);
          else this.car.setAccelerationY(0);
        } else {
          this.car.setAccelerationY(0);
          this.car.setDragY(300);
        }
        if (this.opponent.body.velocity.y > -maxSpeed*0.9) this.opponent.setAccelerationY(-150);
        else this.opponent.setAccelerationY(0);

        const speedKmh = Math.round(Math.abs(this.car.body.velocity.y)*3.6);
        document.getElementById('speedometer').textContent = `Speed: ${speedKmh} km/h`;
      }
      playerWins(){ if(!this.finished){ this.finished=true; alert('🏁 You Win!'); gameStartedFlag=false; } }
      opponentWins(){ if(!this.finished){ this.finished=true; alert('💥 Opponent Wins!'); gameStartedFlag=false; } }
    }

    function startGame() {
      if (phaserGame) { phaserGame.destroy(true); }
      phaserGame = new Phaser.Game({
        type: Phaser.AUTO,
        width: window.innerWidth,
        height: window.innerHeight,
        backgroundColor: '#111',
        parent: 'phaser-root',
        physics: { default: 'arcade', arcade: { gravity: { y: 0 }, debug: false } },
        scene: DragRace,
        scale: { mode: Phaser.Scale.RESIZE, autoCenter: Phaser.Scale.CENTER_BOTH }
      });
    }

    // UI wiring
    document.querySelectorAll('#track-choices img').forEach(img=>{
      img.addEventListener('click',()=>{
        document.querySelectorAll('#track-choices img').forEach(i=>i.classList.remove('selected'));
        img.classList.add('selected'); selectedTrack = img.dataset.value;
      });
    });
    document.querySelectorAll('#car-choices img').forEach(img=>{
      img.addEventListener('click',()=>{
        document.querySelectorAll('#car-choices img').forEach(i=>i.classList.remove('selected'));
        img.classList.add('selected'); selectedCar = img.dataset.value;
      });
    });

    document.getElementById('start-btn').addEventListener('click',()=>{
      document.getElementById('menu').style.display='none';
      document.getElementById('phaser-root').style.display='block';
      document.getElementById('hud').style.display='flex';
      startGame();
    });

    document.getElementById('back-btn').addEventListener('click',()=>{
      location.reload();
    });
    document.getElementById('game-start-btn').addEventListener('click',()=>{
      gameStartedFlag = true;
      if (sceneRef) sceneRef.car.setAccelerationY(0);
    });
    document.getElementById('restart-btn').addEventListener('click',()=>{
      gameStartedFlag = false;
      startGame();
      document.getElementById('speedometer').textContent = 'Speed: 0 km/h';
    });
  </script>
</body>
</html>
