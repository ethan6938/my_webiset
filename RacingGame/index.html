<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Drag Race</title>
  <script src="https://cdn.jsdelivr.net/npm/phaser@3.55.2/dist/phaser.min.js"></script>
  <style>
    body {
      margin: 0;
      background: #111;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      overflow: hidden;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
    #phaser-example {
      border: 4px solid #fff;
      box-shadow: 0 0 25px #111;
      max-width: 100vw;
      max-height: 100vh;
      position: relative;
    }
    #speedometer, #restart-btn, #winner-banner {
      position: absolute;
      font-family: monospace;
      font-size: 20px;
      color: white;
      background: rgba(0, 0, 0, 0.4);
      padding: 8px 12px;
      border-radius: 8px;
      user-select: none;
      z-index: 100;
    }
    #speedometer {
      top: 15px;
      left: 15px;
    }
    #restart-btn {
      bottom: 15px;
      left: 50%;
      transform: translateX(-50%);
      pointer-events: auto;
      cursor: pointer;
      padding: 10px 20px;
      background: rgba(255, 255, 255, 0.15);
      border: 2px solid white;
      transition: background 0.3s ease;
    }
    #restart-btn:hover {
      background: rgba(255, 255, 255, 0.4);
    }
    #winner-banner {
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 28px;
      display: none;
      background: rgba(0, 0, 0, 0.8);
    }
  </style>
</head>
<body>
  <div id="phaser-example"></div>
  <div id="speedometer">Speed: 0 km/h</div>
  <div id="winner-banner">You Win!</div>
  <button id="restart-btn">Restart</button>

  <script>
    class DragRace extends Phaser.Scene {
      constructor() {
        super('DragRace');
      }

      preload() {
        this.load.image('track', 'images/track.png');
        this.load.image('car', 'images/car.png');
        this.load.image('opponent', 'images/car2.png');
      }

      create() {
        this.add.image(400, 300, 'track').setScale(0.8);
        this.speedometer = document.getElementById('speedometer');
        this.restartBtn = document.getElementById('restart-btn');
        this.winnerBanner = document.getElementById('winner-banner');

        this.car = this.physics.add.sprite(300, 500, 'car').setScale(0.15);
        this.opponent = this.physics.add.sprite(500, 500, 'opponent').setScale(0.15);
        this.car.setMaxVelocity(600);
        this.opponent.setMaxVelocity(600);
        this.car.setCollideWorldBounds(true);
        this.opponent.setCollideWorldBounds(true);

        this.physics.world.setBounds(0, 0, 800, 600);

        this.finishLine = this.add.zone(400, 100, 800, 10);
        this.physics.world.enable(this.finishLine);
        this.finishLine.body.setAllowGravity(false);
        this.finishLine.body.moves = false;

        this.physics.add.overlap(this.car, this.finishLine, this.playerWins, null, this);
        this.physics.add.overlap(this.opponent, this.finishLine, this.opponentWins, null, this);

        this.keys = this.input.keyboard.addKeys('W');
        this.finished = false;
        this.raceStarted = false;

        this.restartBtn.addEventListener('click', () => this.restartRace());

        this.countdownText = this.add.text(400, 300, '', {
          fontSize: '64px',
          color: '#fff'
        }).setOrigin(0.5);

        this.startCountdown();
      }

      startCountdown() {
        let countdown = ['3', '2', '1', 'GO!'];
        let index = 0;

        this.time.addEvent({
          delay: 1000,
          repeat: countdown.length - 1,
          callback: () => {
            this.countdownText.setText(countdown[index]);
            if (countdown[index] === 'GO!') {
              this.raceStarted = true;
              this.countdownText.setText('');
              this.opponentStartDelay = Phaser.Math.Between(300, 1000);
              this.time.delayedCall(this.opponentStartDelay, () => {
                this.opponent.setAccelerationY(-600);
              });
            }
            index++;
          }
        });
      }

      update(time, delta) {
        const dt = delta / 1000;
        const acceleration = 800;
        const maxSpeed = 600;

        if (this.raceStarted && !this.finished) {
          if (this.keys.W.isDown) {
            this.car.setAccelerationY(-acceleration);
          } else {
            this.car.setAccelerationY(0);
            this.car.setDragY(400);
          }

          if (this.opponent.body.velocity.y < -maxSpeed) {
            this.opponent.setVelocityY(-maxSpeed);
            this.opponent.setAccelerationY(0);
          }
        }

        const speedKmh = Math.round(Math.abs(this.car.body.velocity.y) * 3.6);
        this.speedometer.textContent = `Speed: ${speedKmh} km/h`;
      }

      playerWins() {
        if (!this.finished) {
          this.finished = true;
          this.showWinner("You Win!");
        }
      }

      opponentWins() {
        if (!this.finished) {
          this.finished = true;
          this.showWinner("Opponent Wins!");
        }
      }

      showWinner(text) {
        this.winnerBanner.textContent = text;
        this.winnerBanner.style.display = 'block';
      }

      restartRace() {
        this.finished = false;
        this.raceStarted = false;
        this.winnerBanner.style.display = 'none';
        this.car.setPosition(300, 500);
        this.opponent.setPosition(500, 500);
        this.car.setVelocity(0);
        this.opponent.setVelocity(0);
        this.car.setAccelerationY(0);
        this.opponent.setAccelerationY(0);
        this.startCountdown();
      }
    }

    const config = {
      type: Phaser.AUTO,
      width: 800,
      height: 600,
      backgroundColor: '#111',
      parent: 'phaser-example',
      physics: {
        default: 'arcade',
        arcade: {
          debug: false,
          gravity: { y: 0 }
        }
      },
      scene: DragRace,
      scale: {
        mode: Phaser.Scale.FIT,
        autoCenter: Phaser.Scale.CENTER_BOTH
      }
    };

    new Phaser.Game(config);
  </script>
</body>
</html>
