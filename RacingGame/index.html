<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Drag Race</title>
  <script src="https://cdn.jsdelivr.net/npm/phaser@3.55.2/dist/phaser.min.js"></script>
  <style>
    body {
      margin: 0;
      background: #000;
      overflow: hidden;
    }
    #phaser-example {
      width: 100vw;
      height: 100vh;
    }
    #speedometer, #restart-btn {
      position: absolute;
      font-family: monospace;
      font-size: 20px;
      color: white;
      background: rgba(0, 0, 0, 0.4);
      padding: 8px 12px;
      border-radius: 8px;
      z-index: 10;
    }
    #speedometer {
      top: 15px;
      left: 15px;
    }
    #restart-btn {
      bottom: 15px;
      left: 50%;
      transform: translateX(-50%);
      cursor: pointer;
      padding: 10px 20px;
      background: rgba(255, 255, 255, 0.15);
      border: 2px solid white;
      transition: background 0.3s ease;
    }
    #restart-btn:hover {
      background: rgba(255, 255, 255, 0.4);
    }
  </style>
</head>
<body>
  <div id="phaser-example"></div>
  <div id="speedometer" style="display:none">Speed: 0 km/h</div>
  <button id="restart-btn" style="display:none">Restart</button>

  <script>
    let selectedTrack = 'easy';
    let selectedCar = 'car';

    class MenuScene extends Phaser.Scene {
      constructor() {
        super('MenuScene');
      }

      preload() {
        this.load.image('easy', 'images/easy.png');
        this.load.image('medium', 'images/medium.png');
        this.load.image('hard', 'images/hard.png');
        this.load.image('car', 'images/car.png');
        this.load.image('car2', 'images/car2.png');
      }

      create() {
        this.add.text(100, 50, 'Select Your Track', { fontSize: '24px', fill: '#fff' });

        ['easy', 'medium', 'hard'].forEach((difficulty, i) => {
          const y = 100 + i * 120;
          const preview = this.add.image(150, y, difficulty).setDisplaySize(200, 100).setInteractive();
          preview.on('pointerdown', () => {
            selectedTrack = difficulty;
            this.selectCar();
          });
        });
      }

      selectCar() {
        this.scene.pause();
        this.scene.launch('CarSelectScene');
      }
    }

    class CarSelectScene extends Phaser.Scene {
      constructor() {
        super('CarSelectScene');
      }

      create() {
        this.add.text(100, 50, 'Select Your Car', { fontSize: '24px', fill: '#fff' });

        const car1 = this.add.image(200, 200, 'car').setScale(0.25).setInteractive();
        const car2 = this.add.image(400, 200, 'car2').setScale(0.25).setInteractive();

        car1.on('pointerdown', () => this.startGame('car'));
        car2.on('pointerdown', () => this.startGame('car2'));
      }

      startGame(car) {
        selectedCar = car;
        this.scene.stop('CarSelectScene');
        this.scene.stop('MenuScene');
        this.scene.start('DragRace');
      }
    }

    class DragRace extends Phaser.Scene {
      constructor() {
        super('DragRace');
      }

      preload() {
        this.load.image('easy', 'images/easy.png');
        this.load.image('medium', 'images/medium.png');
        this.load.image('hard', 'images/hard.png');
        this.load.image('car', 'images/car.png');
        this.load.image('car2', 'images/car2.png');
      }

      create() {
        const bg = this.add.image(0, 0, selectedTrack).setOrigin(0);
        bg.setDisplaySize(this.scale.width, this.scale.height);

        this.car = this.physics.add.sprite(this.scale.width / 2 - 50, this.scale.height - 100, selectedCar).setScale(0.15);
        this.opponent = this.physics.add.sprite(this.scale.width / 2 + 50, this.scale.height - 100, selectedCar === 'car' ? 'car2' : 'car').setScale(0.15);

        this.car.setCollideWorldBounds(true);
        this.opponent.setCollideWorldBounds(true);

        this.keys = this.input.keyboard.addKeys('W');
        this.finished = false;

        this.finishLine = this.add.zone(this.scale.width / 2, 50, this.scale.width, 10);
        this.physics.world.enable(this.finishLine);
        this.finishLine.body.setAllowGravity(false);
        this.finishLine.body.moves = false;

        this.physics.add.overlap(this.car, this.finishLine, this.playerWins, null, this);
        this.physics.add.overlap(this.opponent, this.finishLine, this.opponentWins, null, this);

        document.getElementById('speedometer').style.display = 'block';
        document.getElementById('restart-btn').style.display = 'block';
        document.getElementById('restart-btn').onclick = () => this.restartRace();
      }

      update(time, delta) {
        if (this.finished) return;

        const acceleration = 800;
        const maxSpeed = 600;

        if (this.keys.W.isDown) {
          this.car.setAccelerationY(-acceleration);
        } else {
          this.car.setAccelerationY(0);
          this.car.setDragY(400);
        }

        if (this.opponent.body.velocity.y > -maxSpeed) {
          this.opponent.setAccelerationY(-600);
        } else {
          this.opponent.setAccelerationY(0);
          this.opponent.setVelocityY(-maxSpeed);
        }

        const speedKmh = Math.round(Math.abs(this.car.body.velocity.y) * 3.6);
        document.getElementById('speedometer').textContent = `Speed: ${speedKmh} km/h`;
      }

      playerWins() {
        if (!this.finished) {
          this.finished = true;
          alert('You Win!');
        }
      }

      opponentWins() {
        if (!this.finished) {
          this.finished = true;
          alert('Opponent Wins!');
        }
      }

      restartRace() {
        this.finished = false;
        this.car.setPosition(this.scale.width / 2 - 50, this.scale.height - 100);
        this.opponent.setPosition(this.scale.width / 2 + 50, this.scale.height - 100);
        this.car.setVelocity(0);
        this.opponent.setVelocity(0);
      }
    }

    const config = {
      type: Phaser.AUTO,
      width: window.innerWidth,
      height: window.innerHeight,
      backgroundColor: '#111',
      parent: 'phaser-example',
      physics: {
        default: 'arcade',
        arcade: { gravity: { y: 0 }, debug: false }
      },
      scene: [MenuScene, CarSelectScene, DragRace],
      scale: {
        mode: Phaser.Scale.RESIZE,
        autoCenter: Phaser.Scale.CENTER_BOTH
      }
    };

    new Phaser.Game(config);
  </script>
</body>
</html>
